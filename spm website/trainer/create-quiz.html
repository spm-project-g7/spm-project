<!DOCTYPE html>
<html lang="en">
    

<head>
    
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Course Details</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="../assets/img/favicon.png" rel="icon">
    <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="../assets/vendor/animate.css/animate.min.css" rel="stylesheet">
    <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="../assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <!-- Template Main CSS File -->
    <link href="../assets/css/style.css" rel="stylesheet">

    <!-- jQuery & Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>


    <!-- =======================================================
    * Template Name: Mentor - v4.4.0
    * Template URL: https://bootstrapmade.com/mentor-free-education-bootstrap-theme/
    * Author: BootstrapMade.com
    * License: https://bootstrapmade.com/license/
    ======================================================== -->
</head>

<body>

    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top">
        <div class="container d-flex align-items-center">

        <h1 class="logo me-auto"><a href="index.html">Learning Portal</a></h1>
        <!-- Uncomment below if you prefer to use an image logo -->
        <!-- <a href="index.html" class="logo me-auto"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->

        <nav id="navbar" class="navbar order-last order-lg-0">
            <ul>
                <li><a class="active" href="homepage.html">Home</a></li>
                <li><a href="quiz.html">Quizzes</a></li>
                <li><a href="#">Assignments</a></li>
                <li><a href="#">Forum</a></li>
                <li><a href="#">Chats</a></li>
                <li class="dropdown"><a href="#"><span>Courses</span> <i class="bi bi-chevron-down"></i></a>
                    <ul>
                        <li><a href="all-courses.html">All Courses</a></li>
                        <li><a href="courses.html">Current Courses</a></li>
                        <li><a href="past-courses.html">Past Courses</a></li>        
                    </ul>
                </li>
                <li class="dropdown"><a href="#"><span>Trainer Name</span> <i class="bi bi-chevron-down"></i></a>
                    <ul>
                    <li><a href="#">Profile</a></li>
                    <li><a href="#">Settings</a></li>
                    </ul>
                </li>
            </ul>
            <i class="bi bi-list mobile-nav-toggle"></i>
        </nav><!-- .navbar -->

        <a href="../Homepage.html" class="get-started-btn">Logout</a>

        </div>
    </header>
    <!-- End Header -->

    <main id="main">

        <!-- ======= Breadcrumbs ======= -->
        <div class="breadcrumbs" data-aos="fade-in">
            <div class="container">
                <h2>Create Quiz</h2>
            </div>
        </div>
        <!-- End Breadcrumbs -->

        <!-- ======= Specific Course Details Section ======= -->
        <div class="container">
            <form action='' method='POST'>
                <div id="quiz-portion">
                    <div class="row mt-3" id="create-quiz">
                        <select class="custom-select col-5 mr-4" id="selectcourse" onchange="getClasses()"></select>
                        <select class="custom-select col-5" id="selectclass">
                            <option selected>Select a class</option>
                        </select>
                    </div>
                    <div class="row mt-3">
                        <input type="date" class="form-control col-5 mr-4" id="quizdate" placeholder="Pick a Date (YYYY-MM-DD)">
                        <select class="custom-select col-5" id="selectgraded">
                            <option value='1' selected>Graded</option>
                            <option value='0'>Ungraded</option>
                        </select> 
                    </div>
                    <div class="row mt-3">
                        <input type="text" class="form-control col-5 mr-4" id="quiz-name" placeholder="Quiz Name">
                        <input type="text" class="form-control col-5 mr-4" id="quiz-grade" placeholder="Passing Grade for Quiz">
                    </div>
                    <div class="row mt-3">
                        <input type="text" class="form-control col-5 mr-4" id="quiz-score" placeholder="Quiz Score">
                        <input type="text" class="form-control col-5 mr-4" id="quiz-lesson" placeholder="Lesson">
                    </div>
                    <div class="row mt-3">
                        <input type="text" class="form-control col-5 mr-4" id="quiz-time" placeholder="Quiz Time">
                    </div>
                    <div class="row mt-3 mb-3 qnsblock" id="question-block1">
                        <div class="card" style="padding-left: 0; padding-right: 0;">
                            <div class="card-header">
                                <label for="Question">Question:</label>
                                <textarea class="form-control allqns" id="Question1" rows="3" ></textarea>
                                <label for="Answer">Answer:</label>
                                <textarea class="form-control allans" id="Answer1" rows="3"></textarea>
                            </div>
                            <div class="card-body" id='optiondetalis'>
                                <select class="custom-select col-5" id="selectquiztype1" onchange="showQnsType(this.id)">
                                    <option selected>Select Quiz Type</option>
                                    <option value='T/F'>True/False (T/F)</option>
                                    <option value='MCQ'>Multiple Choice Question (MCQ)</option>
                                </select> 
                                <div class="row ml-4 mt-2" id="showqnstype1"></div>
                                <div>
                                    <button class="col-sm-5 btn btn-outline-secondary" type='button' id="add-qns1" onclick="deleteQuestion(this.id)">Delete Question</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3 mb-3">
                    <button class="col-sm-4 btn btn-outline-secondary" type='button' id="add-qns" onclick="addQuestion()">Add New Question</button>
                </div>
                <div class="row mt-3 mb-3">
                    <button class="col-sm-3 btn btn-outline-secondary" type='button' id="create-quiz" onclick="createQuiz()">Create Quiz</button>
                </div>
            </form>
            <div id="error" style="text-align: center;">
                <!-- Error message will be appended here  -->
            </div>
            <script>
                function GetURLParameter(sParam)
                {
                    var sPageURL = window.location.search.substring(1);
                    var sURLVariables = sPageURL.split('&');
                    for (var i = 0; i < sURLVariables.length; i++) 
                    {
                        var sParameterName = sURLVariables[i].split('=');
                        if (sParameterName[0] == sParam) 
                        {
                            return sParameterName[1];
                        }
                    }
                }

                var quizID = parseInt(GetURLParameter('quiz')) + 1;

                // function to add question
                var qnscount = 1;
                var mcqoption = 1;
                var total = [];

                function pushToList() {
                    var allQuestions = document.getElementsByClassName('qnsblock');
                    var allQns = document.getElementsByClassName('allqns');
                    var allAns = document.getElementsByClassName('allans');
                    var qns = allQns[qnscount - 1].value;
                    var ans = allAns[qnscount - 1].value;
                    console.log(allQuestions.length)
                    var allOptions = document.getElementsByClassName('allopts' + qnscount.toString());
                    var optlist = [];
                    for (i = 0; i < allOptions.length; i++) {
                        // console.log(i)
                        console.log(qnscount);
                        // var allOptions = document.getElementsByClassName('allopts' + qnscount.toString());
                        console.log(allOptions);
                        var val = allOptions[i].value;
                        optlist.push(val);
                        // console.log(qns, ans, val);
                    }
                    var obj = { question: qns, answer: ans, options: optlist}
                    console.log(obj);
                    total.push(obj);
                    console.log(total);

                }
                function addQuestion() {
                    pushToList();
                    qnscount += 1
                    mcqoption = 1
                    // console.log(qnscount);
                    $('#quiz-portion').append(
                        "<div class='row mt-3 mb-3 qnsblock' id='question-block" + qnscount.toString() + "'>" +
                            "<div class='card' style='padding-left: 0; padding-right: 0;''>" +
                                "<div class='card-header'>" +
                                    "<label for='Question'>Question:</label>" +
                                    "<textarea class='form-control allqns' id='Question" + qnscount.toString() + "' rows='3' ></textarea>" +
                                    "<label for='Answer'>Answer:</label>" +
                                    "<textarea class='form-control allans' id='Answer" + qnscount.toString() + "' rows='3' ></textarea>" +
                                "</div>" +
                                "<div class='card-body'>" +
                                    "<div class='dropdown'>" +
                                        "<select class='custom-select col-5' id='selectquiztype" + qnscount.toString() + "' onchange='showQnsType(this.id)'>" +
                                            "<option selected>Select Quiz Type</option>" +
                                            "<option value='T/F'>True/False (T/F)</option>" +
                                            "<option value='MCQ'>Multiple Choice Question (MCQ)</option>" +
                                        "</select>" + 
                                        "<div class='row ml-4 mt-2' id='showqnstype" + qnscount.toString() + "'>" +
                                            "<div id='qnstype" + qnscount.toString() + "'></div>" +
                                        "</div>" +
                                    "</div>" +
                                    "<div>" +
                                        "<button class='col-sm-5 btn btn-outline-secondary' type='button' id='add-qns" + qnscount.toString() + "' onclick='deleteQuestion(this.id)'>Delete Question</button>" +
                                    "</div>" +
                                "</div>" +
                            "</div>" +
                        "</div>" 
                    )
                }

                // delete question
                function deleteQuestion(ID) {
                    // var element = document.getElementById('question-block' + qnscount.toString());
                    var element = document.getElementById(ID);
                    var qnsblock = element.parentNode.parentNode.parentNode;
                    // console.log(qnsblock);
                    qnsblock.remove();
                    // element.remove();
                    qnscount -= 1;
                    // console.log(qnscount);
                }

                // Helper function to display error message
                function showError(message) {
                    // Hide the table and button in the event of error
                    $('#create-quiz').hide();
            
                    // Display an error under the main container
                    $('#error')
                        .append("<label>"+message+"</label>");
                }

                // get classes for course
                $(async () => {
                    var serviceURL = "http://54.255.62.181/:5000/course";
                    try {
                        const response =
                        await fetch(
                            serviceURL, { method: 'GET' }
                        );
                        const result = await response.json();
                        if (response.status == 200) {
                            // success case
                            var allCourses = result.data.courses; 
                            var options = "<option selected>Select a course</option>";
                            for (const course of allCourses) {
                                options += "<option value = '" + course.CourseID + "'>" + course.CourseName + "</option>";
                            }
                            var dropdownelem = document.getElementById('selectcourse');
                            dropdownelem.innerHTML = options;
                        }
                    }
                    catch (error) {
                        // Errors when calling the service; such as network error, 
                        // service offline, etc
                        alert('There is a problem fetching the list of courses, please try again later.');
                    } // error
                });

                function getClasses() {
                    $(async () => {
                        var courseID = document.getElementById('selectcourse').value;
                        var serviceURL = "http://54.255.62.18:5000/class/course/" + courseID;
                        try {
                            const response =
                            await fetch(
                                serviceURL, { method: 'GET' }
                            );
                            const result = await response.json();
                            if (response.status == 200) {
                                // success case
                                var allClasses = result.data.classes; 
                                var options = "<option selected>Select a class</option>";
                                for (const oneclass of allClasses) {
                                    options += "<option value = '" + oneclass.ClassID + "'>" + oneclass.ClassName + "</option>";
                                }
                                var dropdownelem = document.getElementById('selectclass');
                                dropdownelem.innerHTML = options;
                            }
                        }
                        catch (error) {
                            // Errors when calling the service; such as network error, 
                            // service offline, etc
                            alert('There is a problem fetching the list of classes, please try again later.');
                        } // error
                    });

                }

                // show whether it's mcq or t/f qns
                function showQnsType(quizTypeID) {
                    var idstring = 'qnstype' + quizTypeID.slice(-1);
                    // console.log(idstring2);
                    var qnstypeval = document.getElementById(quizTypeID).value + qnscount.toString();
                    var element = document.getElementById(idstring);
                    if (element != null) {
                        element.remove()
                    }
                    
                    if (qnstypeval == 'T/F' + qnscount.toString()) {
                        $('#showqnstype' + qnscount.toString()).append(
                        "<div id='qnstype" + qnscount.toString() + "'>" +
                            "<div>" +
                                "<input class='form-check-input' type='radio' name='flexRadioDefault' id='optiontrue" + qnscount.toString() + "'> True" +                        
                            "</div>" +
                            "<div>" +
                                "<input class='form-check-input' type='radio' name='flexRadioDefault' id='optionfalse" + qnscount.toString() + "'> False" +
                            "</div>" +
                        "</div>"
                        );
                    }
                    else {
                        $('#showqnstype' + qnscount.toString()).append(
                                "<div id='qnstype" + qnscount.toString() + "'>" +
                                    "<div id='mcqoption" + qnscount.toString() + mcqoption.toString() + "'>" +
                                        "<input class='form-check-input' type='radio' name='flexRadioDefault'>" + 
                                        "<input type='text' class='form-control col-5 mr-4 allopts" + qnscount.toString() + "' placeholder='Please type in the option' id='mcqoption" + qnscount.toString() + mcqoption.toString() + "'>" +    
                                        "<button class='btn btn-outline-secondary' type='button' id='del-option" + qnscount.toString() + mcqoption.toString() + "' onclick='deleteOption(this.id)'>Delete Option</button>" +                    
                                    "</div>" +
                                "</div>" +
                                "<div>" + 
                                    "<button class='btn btn-outline-secondary' type='button' id='add-option" + qnscount.toString() + "' onclick='addOption(this.id)'>Add Option</button>" +
                                "</div>" 
                        );
                    }
                }

                function addOption(ID) {
                    mcqoption += 1;
                    var elementID = document.getElementById(ID).parentNode.previousSibling.id;
                    $("#" + elementID).append(
                        "<div id='mcqoption" + qnscount.toString() + mcqoption.toString() + "'>" +
                            "<input class='form-check-input' type='radio' name='flexRadioDefault'>" + 
                            "<input type='text' class='form-control col-5 mr-4 allopts" + qnscount.toString() + "' placeholder='Please type in the option' id ='mcqoption" + qnscount.toString() + mcqoption.toString() + "'>" +               
                            "<button class='btn btn-outline-secondary' type='button' id='del-option" + qnscount.toString() + mcqoption.toString() + "' onclick='deleteOption(this.id)'>Delete Option</button>" +                             
                        "</div>"
                    );
                }

                function deleteOption(ID) {
                    var elementID = document.getElementById(ID).parentNode.id;
                    var element = document.getElementById(elementID);
                    element.remove();
                    mcqoption -= 1;
                }

                function insertQuestions() {
                    var count = 0;
                    $(async () => {
                        for (i = 0; i < total.length; i++) {
                            var data = total[i];
                            var qnsID = i + 1;
                            var jsondata = JSON.stringify({ QuestionID: qnsID, Options: data.options.toString(), Question: data.question, Answer: data.answer });
                            var serviceURL = "http://54.255.62.18:5000/question/create/" + quizID;
                            try {
                                const response =
                                await fetch(
                                    serviceURL, {
                                    method: 'POST',
                                    headers: { "Content-Type": "application/json" },
                                    body: jsondata,
                                });
                                const data = await response.json();
                                const information = await data;
                                count += 1;
                                console.log(information);
                                if(response.ok){
                                    // alert("Question successfully created!");
                                } else {
                                    alert(data.message);
                                    // alert("An error occurred.");
                                }  
                            }
                            catch (error) {
                                // Errors when calling the service; such as network error, 
                                // service offline, etc
                                console.log(error);
                                // alert(error);
                            } // error
                        }
                        console.log(count);
                        console.log(total);
                        if (count != total.length) {
                            alert('There is a problem creating the questions, please try again later.');
                        }
                        else {
                            alert('Questions successfully created!');
                        }

                    });

                }

                function createQuiz() {
                    pushToList();
                    var quizName = document.getElementById('quiz-name').value;
                    var quizPassGrade = document.getElementById('quiz-grade').value;
                    var quizScore = document.getElementById('quiz-score').value;
                    var quizTime = parseInt(document.getElementById('quiz-time')).value;
                    $(async () => {
                        var lessonID = $('#quiz-lesson').val();
                        var lastUpdated = $('#quizdate').val();
                        var graded = $('#selectgraded').val();
                        var passing = $('#quiz-grade').val();
                        var quizName = $('#quiz-name').val();
                        var quizScore = $('#quiz-score').val();
                        var quizTime = parseInt( $('#quiz-time').val());
                        var serviceURL = "http://54.255.62.18:5000/quiz/create/" + lessonID;
                        var jsondata = JSON.stringify({ LastUpdated: lastUpdated, GradedQuiz: graded, PassingGrade: passing, LessonID: lessonID, 
                                                        QuizScore: quizScore, QuizName: quizName, QuizTime: quizTime });
                        try {
                            const response =
                            await fetch(serviceURL, 
                            {
                                method: 'POST',
                                headers: { 
                                    "Content-Type": "application/json" 
                                },
                                body: jsondata,
                                
                            });
                            const data = await response.json();
                            const information = await data;
                            if(response.ok){
                                alert("Quiz successfully created!");
                            } else {
                                // alert(data.message);
                                alert("An error occurred.");
                            }   
                        }
                        catch (error) {
                            // Errors when calling the service; such as network error, 
                            // service offline, etc
                            console.log(error);
                            alert('There is a problem creating the quiz, please try again later.');
                        } // error
                    });

                    insertQuestions();

                }

            

            </script>        
        </div>

    </main>
    <!-- End #main -->

  

    <!-- Template Main JS File -->
    <script src="../assets/js/main.js"></script>
    <script src="quiz.js"></script>


</body>

</html>